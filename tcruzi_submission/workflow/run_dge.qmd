---
title: "run_dge"
format: html
---

```{r}
# Load necessary libraries
library(DESeq2)
library(ggplot2)

count_data <- readRDS("results_tcruzi/gather/count_table_hisat2.rds")

col_data <- read.csv("data/metadata.csv", row.names = 1)

colnames(count_data) <- rownames(col_data)

rownames(count_data)[which.max(rowSums(count_data))] # q3

# The design ~ strain + condition models the effect of 'condition' while accounting for baseline differences between strains.
dds <- DESeqDataSetFromMatrix(countData = count_data,
                              colData = col_data,
                              design = ~ strain + condition)

# Run the DESeq2 analysis
dds <- DESeq(dds)

# Get the results for the condition comparison (TcP21-/- vs Cas9)
res <- results(dds, name="condition_TcP21_vs_Cas9", tidy = T)
summary(res)

res <- res[complete.cases(res),]
sig_gene <- res[res$pvalue < 0.01, ]
nrow(sig_gene) # q5

res2 <- results(dds, name="strain_Y_vs_G", tidy = T)
res2$row[max(res2$log2FoldChange, na.rm = T)] # q4
```

